<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daftar Pengguna Baharu â€” Sistem Pengurusan ICT Sekolah</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: url('https://lh3.googleusercontent.com/d/1AS3tZyizHN4D58G6Vy2UkgWD18MGPhCu=w2000') no-repeat center center/cover;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.form-box {
  width: 380px;
  padding: 25px;
  border-radius: 12px;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(8px);
  color: white;
  box-shadow: 0 8px 30px rgba(0,0,0,0.3);
}

h3 { text-align:center; margin-bottom: 20px; }
label { font-size: 13px; font-weight: 500; }

.input-wrapper {
  position: relative;
}

input, select {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.1);
  color: #ffffff5c;
  box-sizing: border-box;
}

input::placeholder {
  color: #e0e0e061;
}

.toggle-password {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  user-select: none;
}

.eye-icon {
  color: #ffffff41;
  transition: color .3s;
}

.toggle-password:hover .eye-icon {
  color: #3b82f6;
}

button {
  width: 100%;
  padding: 10px;
  border: none;
  background: linear-gradient(135deg, #3b82f6, #9333ea);
  color: white;
  font-size: 14px;
  border-radius: 8px;
  cursor:pointer;
  margin-top: 8px;
}

button:hover {
  opacity: 0.9;
}

.switch-link {
  text-align: center;
  margin-top: 10px;
  font-size: 13px;
}

.switch-link a {
  color: #3b82f6;
  text-decoration: none;
}

.error {
  color: #ff6b6b;
  font-size: 12px;
  margin-top: -4px;
  margin-bottom: 6px;
  display: none;
}

select option {
  color: #000;
}

/* Password strength bar */
#strengthBar {
  height: 6px;
  width: 0%;
  background: red;
  border-radius: 4px;
  margin-bottom: 8px;
  transition: width .3s ease, background .3s ease;
}
</style>
</head>

<body>

<div class="form-box">
  <h3>Daftar Pengguna Baharu</h3>

  <form id="registerForm">

    <label>Nama Penuh</label>
    <input type="text" id="fullname" placeholder="Nama penuh" required />

    <label>Jawatan</label>
    <select id="position" required>
      <option value="">-- Pilih Jawatan --</option>
      <option value="GURU">Guru</option>
      <option value="AKP">AKP</option>
    </select>

    <label>Bahagian / Sekolah</label>
    <select id="section" required>
      <option value="">-- Pilih Sekolah / Bahagian --</option>
      <option>XBA3201 - SK TUN FUAD</option>
      <option>XBA3202 - SK KUNAK I</option>
      <option>XBA3203 - SK KUNAK 2</option>
      <option>XBA3204 - SK LORMALONG</option>
      <option>XBA3205 - SK MOSTYN</option>
      <option>XBA3206 - SK PANGI</option>
      <option>XBA3207 - SK GADING-GADING</option>
      <option>XBA3208 - SK LADANG GIRAM</option>
      <option>XBA3209 - SK SKIM KOKOS</option>
      <option>XBA3210 - SK KUNAK JAYA</option>
      <option>XBA3211 - SK MADAI</option>
      <option>XBA3213 - SK TANJUNG KERAMAT</option>
      <option>XBA3214 - SK KAMPUNG SELAMAT</option>
      <option>XBA3215 - SK LADANG BINUANG</option>
      <option>XCC3201 - SJKC PAI SHENG</option>
      <option>XEA3201 - SMK KUNAK JAYA</option>
      <option>XEA3202 - SMK MADAI</option>
      <option>XEE3201 - SMK KUNAK</option>
    </select>

    <label>Emel Rasmi</label>
    <input type="email" id="email" placeholder="@moe.gov.my / @moe.edu.my" required />

    <label>Kata Laluan</label>
    <div class="input-wrapper">
      <input type="password" id="password" placeholder="8 aksara termasuk nombor & simbol" required />
      <span class="toggle-password">
        <svg class="eye-icon" width="25" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7-10-7-10-7z"></path>
        </svg>
      </span>
    </div>

    <div id="strengthBar"></div>

    <label>Sahkan Kata Laluan</label>
    <div class="input-wrapper">
      <input type="password" id="confirmPassword" placeholder="Sahkan kata laluan" required />
      <span class="toggle-password">
        <svg class="eye-icon" width="25" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7-10-7-10-7z"></path>
        </svg>
      </span>
    </div>

    <div class="error" id="passwordError"></div>

    <button type="submit">Daftar</button>
  </form>

  <div class="switch-link">
    Sudah ada akaun? <a href="login.html">Kembali ke Log Masuk</a>
  </div>
</div>

<script>
const API_URL = "YOUR_CLOUDFLARE_API_URL"; // Guna Environment variable bila deploy

const registerForm = document.getElementById("registerForm");
const password = document.getElementById("password");
const confirmPassword = document.getElementById("confirmPassword");
const strengthBar = document.getElementById("strengthBar");
const passwordError = document.getElementById("passwordError");

// Password strength
function checkStrength(pw) {
  let score = 0;
  if (pw.length >= 8) score++;
  if (/[0-9]/.test(pw)) score++;
  if (/[!@#$%^&*]/.test(pw)) score++;
  if (/[A-Z]/.test(pw)) score++;
  return score;
}

password.addEventListener("input", () => {
  const score = checkStrength(password.value);
  if (score <= 1) { strengthBar.style.width = "25%"; strengthBar.style.background = "red"; }
  else if (score === 2) { strengthBar.style.width = "50%"; strengthBar.style.background = "orange"; }
  else { strengthBar.style.width = "100%"; strengthBar.style.background = "green"; }
});

// Toggle password eye icon
document.querySelectorAll(".toggle-password").forEach(icon => {
  icon.addEventListener("click", () => {
    const input = icon.previousElementSibling;
    const svg = icon.querySelector("svg");

    if (input.type === "password") {
      input.type = "text";
      svg.innerHTML = `
        <path d="M17.94 17.94L6.06 6.06M1 1l22 22"></path>
        <circle cx="12" cy="12" r="3"></circle>
      `;
    } else {
      input.type = "password";
      svg.innerHTML = `
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7-10-7-10-7z"></path>
      `;
    }
  });
});

// Submit
registerForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("email").value.trim();

  if (!email.endsWith("@moe.gov.my") && !email.endsWith("@moe.edu.my")) {
    passwordError.textContent = "Emel mesti berakhir dengan @moe.gov.my atau @moe.edu.my";
    passwordError.style.display = "block";
    return;
  }

  if (password.value !== confirmPassword.value) {
    passwordError.textContent = "Kata laluan dan pengesahan tidak sepadan.";
    passwordError.style.display = "block";
    return;
  }

  if (checkStrength(password.value) < 3) {
    passwordError.textContent = "Kata laluan terlalu lemah.";
    passwordError.style.display = "block";
    return;
  }

  passwordError.style.display = "none";

  const data = {
    fullname: document.getElementById("fullname").value.trim(),
    position: document.getElementById("position").value,
    section: document.getElementById("section").value,
    email,
    password: password.value
  };

  try {
    const res = await fetch(API_URL + "/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (result.success) {
      alert("Pendaftaran berjaya! Anda boleh log masuk sekarang.");
      window.location.href = "login.html";
    } else {
      alert("Pendaftaran gagal: " + result.error);
    }

  } catch (err) {
    alert("Ralat server. Sila cuba lagi.");
    console.error(err);
  }
});
</script>

</body>
</html>
